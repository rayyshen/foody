<!DOCTYPE html>
<html>

<head>
    <title>Foody</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="bgimg w3-display-container w3-animate-opacity w3-text-white">
        <div class="w3-display-topleft w3-padding-large w3-xlarge">
            Foody
        </div>
        <div class="w3-display-middle">
            <input type="text" class="input-field" id="input"><br>
            <button onClick="tempFunction()" class="scan-button button" id="input-button">Scan Barcode</button>
        </div>
        <div class="w3-display-bottomleft w3-padding-large">
            Made by Ray and Sriram
        </div>
    </div>

    <div class="w3-display-middle table" style="display: none" id="table">
        <table class="table-content">
            <tr>
                <th>Macronutrient</th>
                <th>Amount Per Serving<span id="serving"></span></th>
            </tr>
            <tr>
                <td>Energy</td>
                <td id="engy"></td>
            </tr>
            <tr>
                <td>Carbohydrates</td>
                <td id="carb"></td>
            </tr>
            <tr>
                <td>Protein</td>
                <td id="protein"></td>
            </tr>
            <tr>
                <td>Fats</td>
                <td id="fat"></td>
            </tr>
            <tr>
                <td>Sodium</td>
                <td id="soda"></td>
            </tr>
            <tr>
                <td>Nutriscore</td>
                <td id="score"></td>
            </tr>
            <tfoot>
                <tr>
                    <th colspan="2" id="foot"></th>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>

        function tempFunction() {
            var baseURL = "https://world.openfoodfacts.org/api/v2/product/" + document.getElementById("input").value;
            const userAction = async () => {
                const response = await fetch(baseURL);
                const myJson = await response.json(); //extract JSON from the http response
                // do something with myJson
                return myJson;
            }
            // const myJson = await response.json(); //extract JSON from the http response
            // do something with myJson
            // console.log(myJson);
            // return myJson;
            // };

            userAction().then(data => {
                hideElements();
                var servingSize = data.product.serving_quantity;
                var num = servingSize/100;
                var carbs = data.product.nutriments.carbohydrates_100g;
                var energy = data.product.nutriments.energy_100g;
                var fat = data.product.nutriments.fat_100g;
                var proteins = data.product.nutriments.proteins_100g;
                var score = data.product.nutriscore_grade;
                var sodium = data.product.nutriments.sodium_100g;
                document.getElementById("serving").innerHTML = "(" + servingSize + ")";
                document.getElementById("engy").innerHTML = Math.round(energy*num/4.184) + " Calories";
                document.getElementById("carb").innerHTML = Math.round(carbs*num) + " G";
                document.getElementById("protein").innerHTML = Math.round(proteins*num) + " G";
                document.getElementById("fat").innerHTML = Math.round(fat*num) + " G";
                document.getElementById("soda").innerHTML = Math.round(sodium*num*1000) + " MG";
                document.getElementById("score").innerHTML = score;
                document.getElementById("foot").innerHTML = footerResponse(fat, sodium, score);
                document.getElementById("table").style.display = "block";
            })

        }

        function hideElements() {
            document.getElementById("input").style.display = "none";
            document.getElementById("input-button").style.display = "none";
        }

        function footerResponse(f, s, sc) {
            if(f > 10 || s > 500 || sc === e || sc === d || sc === c){
                return "This item is not recommended for children with diabetes or pre-diabetes";
            }
            else{
                return "This item is safe to consume in moderation for children with diabetes or pre-diabetes";
            }
        }

    </script>

</body>

</html>